<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="1">
        <record id="library.cron_return_reminder" model="ir.cron">
            <field name="name">library.cron_return_reminder</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="state">code</field>
            <field name="code">model._cron_return_reminder()</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
        </record>

        <!-- Keep email template next to the cron sending the mail (TODO: should be moved if more templates are used)-->
        <record id="library.return_reminder_template" model="mail.template">
            <field name="name">library.return_reminder_template</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="email_to">${object.email|safe}</field>
            <field name="lang">${object.lang}</field>
            <field name="subject">Don't forget to return your books!</field>
            <field name="auto_delete" eval="True"/>
            <field name="body_html"><![CDATA[
                    <p>Dear ${object.name},</p>
                    <p>This is a friendly reminder to return the following books:</p>
                    % set late_rentals = ctx.get('late_rentals')
                    <ul>
                    % for rental in late_rentals
                    <li>${rental.book_copy_id.name} (${rental.book_copy_id.internal_id})</li>
                    %endfor
                    </ul>
                    <p>Best regards,</p>
            ]]></field>
        </record>
    </data>
</odoo>